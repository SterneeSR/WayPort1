generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum role {
  rider
  corider
}

enum RideStatus {
  Pending
  Ongoing
  Completed
  Cancelled
  Payment_Pending
  Payment_Done
  Settled
}

enum PaymentStatus {
  Pending
  Success
  Failed
}

model User {
  user_id        Int        @id @default(autoincrement())
  name           String?
  phone_number   String     @unique
  email          String?
  role           role
  wallet_balance Float?     @default(0)
  created_at     DateTime?  @default(now())
  rides          RideParticipant[]
  paymentsMade   Payment[]  @relation("PaymentsMade")
  paymentsRecv   Payment[]  @relation("PaymentsRecv")
  ratingsGiven   Rating[]   @relation("RatingsGiven")
  ratingsRecv    Rating[]   @relation("RatingsRecv")
  reports        Report[]
}

model Ride {
  ride_id       Int              @id @default(autoincrement())
  start_location String?
  end_location   String?
  fare_amount    Float?
  start_time     DateTime?
  end_time       DateTime?
  status         RideStatus      @default(Pending)
  created_at     DateTime?       @default(now())
  participants   RideParticipant[]
  payments       Payment[]
  ratings        Rating[]
  reports        Report[]
}

model RideParticipant {
  id      Int    @id @default(autoincrement())
  rideId  Int
  userId  Int
  role    role
  added_at DateTime? @default(now())
  ride    Ride  @relation(fields: [rideId], references: [ride_id])
  user    User  @relation(fields: [userId], references: [user_id])
}

model Payment {
  payment_id     Int            @id @default(autoincrement())
  rideId         Int?
  payerId        Int?
  payeeId        Int?
  amount         Float?
  payment_method String?
  status         PaymentStatus  @default(Pending)
  payment_time   DateTime?      @default(now())
  ride           Ride?          @relation(fields: [rideId], references: [ride_id])
  payer          User?          @relation("PaymentsMade", fields: [payerId], references: [user_id])
  payee          User?          @relation("PaymentsRecv", fields: [payeeId], references: [user_id])
}

model Rating {
  rating_id    Int       @id @default(autoincrement())
  rideId       Int?
  raterId      Int?
  rateeId      Int?
  rating_value Int?
  feedback_text String?
  created_at   DateTime? @default(now())
  ride         Ride?     @relation(fields: [rideId], references: [ride_id])
  rater        User?     @relation("RatingsGiven", fields: [raterId], references: [user_id])
  ratee        User?     @relation("RatingsRecv", fields: [rateeId], references: [user_id])
}

model Report {
  report_id   Int       @id @default(autoincrement())
  userId      Int?
  rideId      Int?
  category    String?
  message     String?
  created_at  DateTime? @default(now())
  user        User?     @relation(fields: [userId], references: [user_id])
  ride        Ride?     @relation(fields: [rideId], references: [ride_id])
}
